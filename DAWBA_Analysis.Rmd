---
title: "DAWBA Project"
author: "Chase A., Paia A., Parmis K."
date: "2023-06-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

required_Packages_Install <- c("readxl", "writexl", "stringr", "tidyr", 
                               "tidyverse", "dplyr", "ggplot2","hrbrthemes",
                               "gdtools","ggpubr", "ISLR","ggExtra", "shiny",
                               "ggMarginal","patchwork","psych","irr", "scales",
                               "lm.beta", "reghelper", "PerformanceAnalytics",
                               "ppcor", "broom", "multcomp", "lsr", "compute.es")

for(Package in required_Packages_Install){
  if(!require(Package,character.only = TRUE)) { 
    install.packages(Package, dependencies=TRUE)
  }
  library(Package,character.only = TRUE)
}
```

## **Set Working Directory**

```{r rootdir}
wd <- getwd()
rootdir <- (sprintf ('%s', wd))
read.csv(sprintf ('%s/_rawdata.csv', wd))
```

## **Load Data Sets**

```{r readcsv}
dawba <- read_csv('DAWBA_rawdata.csv')
ksads <- read_csv('K-SADS_rawdata.csv')
pars <- read_csv('PARS_rawdata.csv')
scared <- read_csv ('SCARED_rawdata.csv')
mfq <- read_csv ('MFQ_rawdata.csv')

ksads <- ksads %>% drop_na(SDAN)
pars <- pars %>% drop_na(SDAN)
scared <- scared %>% drop_na(SDAN)
mfq <- mfq %>% drop_na(SDAN)
```

### **Merge Data Frames**

```{r}
# Merge df

df <- full_join(dawba, scared, by=SDAN)
df <- full_join(df, mfq, by=SDAN)
df <- full_join(df, pars, by=SDAN)
df <- full_join(df, ksads, by=SDAN)
```


## **1a and 1b – Self-Report Measures: SCARED-CP and MFQ-CP**

1a. linear regression assessing DAWBA band scores for anxiety disorders:
  - Generalized Anxiety Disorder = GAD
  - Separation Anxiety Disorder = Sep AD
  - Social Anxiety Disorder = Social AD

### *Generalized Anxiety Band Score* 
```{r}
# Generalized Anxiety 
gadModel <- lm(cp_average_scared_composite ~ DAWBA_genaband, data = df)
summary(gadModel)
anova(gadModel)
gadModel_coef <- coef(gadModel) # Extract coefficients
cat("Coefficients:\n")
print(gadModel_coef)
gad_ci <- confint(gadModel) # Get CI
cat("\nConfidence Intervals for Coefficients:\n")
print(gad_ci)

# plot (Fig.1a)
ggplot(df, aes(x = DAWBA_genaband, y = cp_average_scared_composite)) +
  geom_point(aes(color = Subject_Type), shape = 1, stroke = 1) +
  geom_smooth(method = lm, color = 'black') +
  ggtitle('DAWBA GAD Band Score & SCARED-CP') +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab('DAWBA GAD Band Score') + ylab('SCARED-CP Average Score') +
  theme(plot.title = element_text(face="bold"))
```

### *Separation Anxiety Band Score* 
```{r}
# Separation Anxiety 
sepModel <- lm(cp_average_scared_composite ~ DAWBA_sepaband, data = df)
summary(sepModel)
anova(sepModel)
sepModel_coef <- coef(sepModel) # Extract coefficients
cat("Coefficients:\n")
print(sepModel_coef)
sep_ci <- confint(sepModel) # Get CI
cat("\nConfidence Intervals for Coefficients:\n")
print(sep_ci)

# plot (Fig.1b)
ggplot(df, aes(x = DAWBA_sepaband, y = cp_average_scared_composite)) +
  geom_point(aes(color = Subject_Type), shape = 1, stroke = 1) +
  geom_smooth(method = lm, color = 'black') +
  ggtitle('DAWBA Sep AD Band Score & SCARED-CP') +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab('DAWBA Sep AD Band Score') + ylab('SCARED-CP Average Score') +
  theme(plot.title = element_text(face="bold"))

```


### *Social Phobia Band Score* 
```{r}
# Social Phobia
sophModel <- lm(cp_average_scared_composite ~ DAWBA_sophband, data = df)
summary(sophModel)
anova(sophModel)
sophModel_coef <- coef(sophModel) # Extract coefficients
cat("Coefficients:\n")
print(sophModel_coef)
soph_ci <- confint(sophModel) # Get CI
cat("\nConfidence Intervals for Coefficients:\n")
print(soph_ci)

# plot (Fig.1c)
ggplot(df, aes(x = DAWBA_sophband, y = cp_average_scared_composite)) +
  geom_point(aes(color = Subject_Type), shape = 1, stroke = 1) +
  geom_smooth(method = lm, color = 'black') +
  ggtitle('DAWBA Soph AD Band Score & SCARED-CP') +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab('DAWBA Soph AD Band Score') + ylab('SCARED-CP Average Score') +
  theme(plot.title = element_text(face="bold"))

```


1b. linear regression assessing DAWBA band scores for MDD:

```{r}
## MDD Band Score Predicting MFQ-CP
# Create the linear regression
mddModel <- lm(sp_mfq_tot ~ comp_dawba_depression_band, data = df)
summary(mddModel)
beta(mddModel)
exp(coef(mddModel)) # Get Odds ratio for predictor
exp(confint(mddModel)) # Get CI

# Plot (Fig.2)
df$Participant_Type <- factor(df$Participant_Type, levels = c("Depressed", "Healthy"))
ggplot(df, aes(x = comp_dawba_depression_band, y = sp_mfq_tot)) +
  geom_point(aes(color = Participant_Type), shape = 1, stroke = 1) +
  geom_smooth(method = lm, color = 'black') +
  ggtitle('DAWBA MDD Band Score & MFQ-CP') +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab('DAWBA MDD Band Score') + ylab('MFQ-CP Average Score') +
  theme(plot.title = element_text(face="bold"))

```


## **1C – Scared-CP Across Treatment**

### *Generalized Anxiety* 
```{r}
## GAD Band Score predicting SCARED-CP across treatment (SCARED-CP difference score)
# Create the linear regression
gadModel <- lm(cp_scared_diff_score ~ DAWBA_genaband, data = df)
summary(gadModel) 
etaSquared(gadModel)

model_coef <- coef(gadModel) # Extract coefficients
cat("Coefficients:\n")
print(model_coef)
conf_interval <- confint(gadModel) # Get CI 
cat("\nConfidence Intervals for Coefficients:\n")
print(conf_interval)


# Plot
as.factor(df$Subject_Type)
factor(df$Subject_Type, c("Anxiety", "HV Child"))
ggplot(df, aes(x = DAWBA_genaband, y = cp_scared_diff_score)) +
  geom_point(aes(color = Subject_Type), shape = 1, stroke = 1) +
  geom_smooth(method = lm, color = 'black') +
  ggtitle('DAWBA GAD Band Score & SCARED-CP Difference Score') +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab('DAWBA GAD Band Score') + ylab('SCARED-cp Difference Score') +
  theme(plot.title = element_text(face="bold"))

```


### *Separation Anxiety*
```{r}
## Sep AD Band Score predicting SCARED-CP across treatment (SCARED-CP difference score)
# Create the linear regression
sepModel <- lm(cp_scared_diff_score ~ DAWBA_sepabandd, data = df)
summary(sepModel) 
etaSquared(sepModel)

model_coef <- coef(sepModel) # Extract coefficients
cat("Coefficients:\n")
print(model_coef)
conf_interval <- confint(sepModel)# Get CI
cat("\nConfidence Intervals for Coefficients:\n")
print(conf_interval)

# Plot
as.factor(df$Subject_Type)
factor(df$Subject_Type, c("Anxiety", "HV Child"))
ggplot(df, aes(x = DAWBA_sepabandd, y = cp_scared_diff_score)) +
  geom_point(aes(color = Subject_Type), shape = 1, stroke = 1) +
  geom_smooth(method = lm, color = 'black') +
  ggtitle('DAWBA Sep AD Band Score & SCARED-CP Difference Score') +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab('DAWBA Sep AD Band Score') + ylab('SCARED-CP Difference Score') +
  theme(plot.title = element_text(face="bold"))



```


### *Social Phobia*
```{r}
## SoPh Band Score predicting SCARED-CP across treatment (dSCARED-CP ifference score)
# Create the linear regression
sophModel <- lm(cp_scared_diff_score ~ DAWBA_sophband, data = df)
summary(sophModel) 
etaSquared(sophModel)

model_coef <- coef(sophModel) # Extract coefficients
cat("Coefficients:\n")
print(model_coef)
conf_interval <- confint(sophModel) # Get CI
cat("\nConfidence Intervals for Coefficients:\n")
print(conf_interval)


# Plot 
as.factor(df$Subject_Type)
factor(df$Subject_Type, c("Anxiety", "HV Child"))
ggplot(df, aes(x = DAWBA_sophband, y = cp_scared_diff_score)) +
  geom_point(aes(color = Subject_Type), shape = 1, stroke = 1) +
  geom_smooth(method = lm, color = 'black') +
  ggtitle('DAWBA Soph AD Band Score & SCARED-CP Difference Score') +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab('DAWBA Soph AD Band Score') + ylab('SCARED-CP Difference Score') +
  theme(plot.title = element_text(face="bold"))

```

## **2a – Clinician-Report Measure: PARS**

### *PARS & DAWBA GAD Band Score*
```{r}
# PARS-GAD
mainModel <- lm(pars_composite ~ DAWBA_genaband, data = df)
summary(mainModel)

model_coef <- coef(mainModel)# Extract coefficients
conf_interval <- confint(mainModel)# Get CI
cat("Coefficients:\n")
print(model_coef)
cat("\nConfidence Intervals for Coefficients:\n")
print(conf_interval)


# Plot (Fig.4a)
as.factor(pars_df$Subject_Type)
#factor(data_PARS$Subject_Type, c("Fluox", "HV Child"))
ggplot(pars_df, aes(x = DAWBA_genaband, y = pars_composite)) +
  geom_point(aes(color = Subject_Type), shape = 1, stroke = 1) +
  geom_smooth(method = lm, color = 'black') +
  ggtitle('DAWBA GAD Band Score & PARS') +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab('DAWBA GAD Band Score') + ylab('PARS Score') +
  theme(plot.title = element_text(face="bold"))

```


### *PARS & DAWBA SepAnx Band Score*

```{r}
# PARS-Sep AD
mainModel <- lm(pars_composite ~ DAWBA_sepabandd * Subject_Type, data = df)
summary(mainModel)
mainModel <- lm(pars_composite ~ DAWBA_sepabandd, data = df)
summary(mainModel)

model_coef <- coef(mainModel)# Extract coefficients
conf_interval <- confint(mainModel)# Get CI
cat("Coefficients:\n")
print(model_coef)
cat("\nConfidence Intervals for Coefficients:\n")
print(conf_interval)


# Plot (Fig.4b)
as.factor(df$Subject_Type)
ggplot(df, aes(x = DAWBA_sepabandd, y = pars_composite)) +
  geom_point(aes(color = Subject_Type), shape = 1, stroke = 1) +
  geom_smooth(method = lm, color = 'black') +
  ggtitle('DAWBA Sep AD Band Score & PARS') +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab('DAWBA Sep AD Band Score') + ylab('PARS Score') +
  theme(plot.title = element_text(face="bold"))


```

### *PARS & DAWBA SocPhob Band Score*

```{r}
# PARS-SoPh
mainModel <- lm(pars_composite ~ DAWBA_sophband * Subject_Type, data = df)
summary(mainModel)
mainModel <- lm(pars_composite ~ DAWBA_sophband, data = df)
summary(mainModel)
model_coef <- coef(mainModel)# Extract coefficients
conf_interval <- confint(mainModel)# Get CI

cat("Coefficients:\n")
print(model_coef)
cat("\nConfidence Intervals for Coefficients:\n")
print(conf_interval)

# Plot (Fig.4c)
as.factor(df$Subject_Type)
ggplot(df, aes(x = DAWBA_sophband, y = pars_composite)) +
  geom_point(aes(color = Subject_Type), shape = 1, stroke = 1) +
  geom_smooth(method = lm, color = 'black') +
  ggtitle('DAWBA Social AD Band Score & PARS') +
  theme(plot.title = element_text(hjust = 0.5)) +
  xlab('DAWBA Social AD Band Score') + ylab('PARS Score') +
  theme(plot.title = element_text(face="bold"))


```

## **2b – PARS Across Treatment**

```{r}
### PARS Across Treatment:  post-treatment (CBT 12 or 8) - pre-treatment (CBT3)

# Create the linear regression
gadModel <- lm(pars_diff_score ~ DAWBA_genaband, data = df) 
# Review the results
summary(gadModel) 

model_coef <- coef(gadModel)# Extract coefficients
conf_interval <- confint(gadModel)# Get CI

cat("Coefficients:\n")
print(model_coef)
cat("\nConfidence Intervals for Coefficients:\n")
print(conf_interval)

```


```{r}
# Create the linear regression
sepModel = lm(pars_diff_score ~ DAWBA_sepabandd, data = df) 
summary(sepModel) 

model_coef <- coef(sepModel)# Extract coefficients
conf_interval <- confint(sepModel)# Get CI

cat("Coefficients:\n")
print(model_coef)
cat("\nConfidence Intervals for Coefficients:\n")
print(conf_interval)

```


```{r}
# Create the linear regression
sophModel = lm(pars_diff_score ~ DAWBA_sophband, data = df) 

summary(sophModel) 

model_coef <- coef(sophModel)# Extract coefficients
conf_interval <- confint(sophModel)# Get CI

cat("Coefficients:\n")
print(model_coef)
cat("\nConfidence Intervals for Coefficients:\n")
print(conf_interval)

```

*Fig.3*
```{r}
df$SDAN <- as.character(df$SDAN)
# Create plot
ggplot(df, aes(x = Interval, y = scared_cp, group = SDAN, color = SDAN)) +
  geom_line(data = df[!is.na(df$scared_cp),]) +
  geom_point() +
  labs(x = "Interval", y = "SCARED-CP Score", title = "SCARED-CP Across Treatment") +
  theme_set(theme_minimal()) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5), legend.position = "none") 

```


*Fig. 5*
```{r}
df$SDAN <- as.character(df$SDAN)
# Create plot
ggplot(df, aes(x = Interval, y = pars_score, group = SDAN, color = SDAN)) +
  geom_line(data = df[!is.na(df$pars_score),]) +
  geom_point() +
  labs(x = "Interval", y = "PARS Score", title = "PARS Across Treatment") +
  theme_set(theme_minimal()) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5), legend.position = "none") 


```


## **Clinical Measure K-SADS & DAWBA Band Scores**

```{r}
## Logistic Reg for KSADS ongoing GAD & DAWBA GAD overall band score
glm.fit <- glm(K_SADS_PL_ANXIETY_ONGOING ~ DAWBA_gadband, data = ksads_gad,  family = binomial, na.rm =TRUE)
summary(glm.fit)
beta(glm.fit)
exp(coef(glm.fit)) # Get Odds ratio for predictor
exp(confint(glm.fit)) # Get confidence interval for predictor
```

